// Code.gs - Apps Script
function doPost(e) {
  try {
    // Parse JSON dari POST body
    var data = JSON.parse(e.postData.contents);

    // Gantikan dengan ID spreadsheet anda
    var SPREADSHEET_ID = "1nfcd9HfYkLOWCzYj_hTihhramz2UmbPEuWkGCAlNcAQ";
    var sheet = SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName("Sheet1");
    if (!sheet) {
      // Jika tiada, buat sheet baru
      sheet = SpreadsheetApp.openById(SPREADSHEET_ID).insertSheet("Sheet1");
      // Header
      sheet.appendRow(["Timestamp","Tarikh","Masa","Petugas","Tajuk","Pencatat","Catatan"]);
    }

    // Append row
    var timestamp = new Date();
    sheet.appendRow([
      timestamp,
      data.date || "",
      data.time || "",
      data.speaker || "",
      data.title || "",
      data.recorder || "",
      data.notes || ""
    ]);

    // Kembalikan respons JSON
    return ContentService
      .createTextOutput(JSON.stringify({ status: 'success', message: 'Disimpan' }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (err) {
    return ContentService
      .createTextOutput(JSON.stringify({ status: 'error', message: err.toString() }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
